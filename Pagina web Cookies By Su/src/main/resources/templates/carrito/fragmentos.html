<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
>
  <head th:replace="~{layout/plantilla :: head}">
    <title>Cookies by Su</title>
  </head>
  <body>
    <!-- 2 fragmento para ver los productos en el carrito -->
    <section th:fragment="verCarrito" th:unless="${#lists.isEmpty(listaItems)}">
      <form action="/carrito/listado">
        <button class="btn btn-sm btn-primary">
          <i class="fas fa-cart-plus"></i> [[#{carrito.verCarrito}]]
          [[${listaTotal}]]
        </button>
      </form>
    </section>

    <!-- 3 visualiza el listado de los items en el carrito -->
    <section th:fragment="listadoCarrito" id="items">
      <div class="container">
        <div class="row g-5 justify-content-md-center">
          <div class="col-md-7">
            <h2 class="fw-bold my-3 fs-2 text-center"
                style="font-family: 'Antonio'">[[#{carrito.titulo}]]</h2>
            <div
              th:if="${listado != null and !listado.empty}"
              class="container"
            >
              <div class="row">
                <div class="col-md-1 fw-bold">#</div>
                <div class="col-md-4 fw-bold">[[#{producto.nombre}]]</div>
                <div class="col-md-2 fw-bold">[[#{producto.precio}]]</div>
                <div class="col-md-2 fw-bold text-center">
                  [[#{carrito.cantidad}]]
                </div>
                <div class="col-md-3 fw-bold"></div>
                <hr />
              </div>
              <div
                class="row py-1"
                th:each="item, contador : ${listado}"
                style="background: #f8f9fa"
              >
                <div class="col-md-1">[[${contador.count}]]</div>
                <div class="col-md-4">[[${item.nombreProducto}]]</div>
                <div class="col-md-2">[[${item.precio}]]</div>
                <div class="col-md-2 text-center">[[${item.cantidad}]]</div>
                <div class="col-md-3 mb-2" style="text-align: center">
                  <a
                    th:href="@{/carrito/modificar/}+${item.idProducto}"
                    class="btn btn-success"
                  >
                    <i class="fa-solid fa-check"></i
                  ></a>
                  <a
                    th:href="@{/carrito/eliminar/}+${item.idProducto}"
                    class="btn btn-danger"
                  >
                    <i class="fa-solid fa-xmark"></i
                  ></a>
                </div>
                <hr />
              </div>
            </div>
            <table class="table table-striped table-hover table-sm mt-6">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">[[#{producto.nombre}]]</th>
                  <th scope="col">[[#{producto.precio}]]</th>
                  <th scope="col">[[#{carrito.cantidad}]]</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="item, contador : ${listado}">
                  <td>[[${contador.count}]]</td>
                  <td>[[${item.nombreProducto}]]</td>
                  <td>[[${item.precio}]]</td>
                  <td class="text-center">[[${item.cantidad}]]</td>
                  <td style="text-align: center">
                    <a
                      th:href="@{/carrito/modificar/}+${item.idProducto}"
                      class="btn btn-success"
                    >
                      <i class="fa-solid fa-check"></i
                    ></a>
                    <a
                      th:href="@{/carrito/eliminar/}+${item.idProducto}"
                      class="btn btn-danger"
                    >
                      <i class="fa-solid fa-xmark"></i
                    ></a>
                  </td>
                </tr>
              </tbody>
            </table>
            <div
              class="text-center p-2"
              th:if="${listado == null or listado.empty}"
            >
              <span>[[#{lista.vacia}]]</span>
            </div>
          </div>
          <div class="col-md-4 order-md-last">
            <h5 class="fw-bold my-3 fs-2 text-center"
                style="font-family: 'Antonio'">
              [[#{carrito.resumen}]]
            </h5>
            <div th:if="${listado != null and !listado.empty}">
              <ul class="list-group mb-3">
                <li
                  class="list-group-item d-flex justify-content-between lh-sm"
                  th:each="item, contador : ${listado}"
                >
                  <div>
                    <h6 class="my-0">[[${item.nombreProducto}]]</h6>
                    <small class="text-muted">x[[${item.cantidad}]]</small>
                  </div>
                  <span class="text-muted"
                    >₡[[${item.precio*item.cantidad}]]</span
                  >
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span>[[#{carrito.subtotal}]]</span>
                  <strong>₡[[${totalCarrito}]]</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <a th:href="@{/facturar/verFacturacion}">
                    <button type="button" class="btn btn-primary btn-block">
                      <i class="fas fa-plus"></i> [[#{carrito.completarOrden}]]
                    </button>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 4 Fragmento que se utiliza en la página modifca.html -->
    <section th:fragment="modificaItem">
      <div class="row-cols-6 p-3">
        <a th:href="@{/carrito/listado}" class="btn btn-primary">
          <i class="fas fa-reply"></i> [[#{accion.regresar}]]
        </a>
      </div>
      <div class="row row-cols-2">
        <div class="card">
          <div class="card-header">[[#{carrito.datos}]]</div>
          <div class="card-body">
            <h5 class="card-title">[[${item.nombreProducto}]]</h5>
            <h6 class="card-subtitle mb-2 text-end">[[${item.precio}]]</h6>
            <p class="card-text">[[${item.descripcion}]]</p>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <figure>
              <img th:src="@{${item.rutaImagen}}" alt="alt" height="200" />
            </figure>
            <div class="row">
              <form
                th:action="@{/carrito/guardar}"
                method="post"
                th:object="${item}"
              >
                <input
                  type="hidden"
                  name="idProducto"
                  th:field="*{idProducto}"
                />
                <input type="number" name="cantidad" th:field="*{cantidad}" />
                <button class="btn btn-success" type="submit" name="guardar">
                  <i class="fas fa-save"></i> [[#{accion.guardar}]]
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </body>
</html>
